services:
  openclawd:
    env_file: .env
    ports:
      - "127.0.0.1:${OPENCLAW_PORT:-18789}:18789"
    volumes:
      - ./data:/home/node/.openclaw:rw
      - ./config:/app/config:rw
      # Patch: fix nostr-tools@2.23.0 subscribeMany double-wrapping bug
      - ./patches/nostr/src/nostr-bus.ts:/app/extensions/nostr/src/nostr-bus.ts:ro
      # Patch: fix missing handleInboundMessage â€” use standard inbound pipeline
      - ./patches/nostr/src/channel.ts:/app/extensions/nostr/src/channel.ts:ro
    environment:
      - DEBUG=true
      - LOG_LEVEL=debug
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

networks:
  openclaw_internal:
    driver: bridge
